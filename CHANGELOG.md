# RLGym2D 更新日志

所有重要的项目更改都会记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [1.1.0] - 2026-01-03

### 新增
- 🎯 **二阶倒立摆任务**（Double Pendulum）- 极高难度的控制任务
- 🧮 **平滑高斯乘法奖励函数** - 解决"弃车保帅"问题的创新奖励设计

### 改进
- ✨ **奖励函数重大改进**（二阶倒立摆）
  - 从阶梯式乘法奖励升级到平滑高斯乘法奖励
  - 使用 `exp(-x²/σ²)` 替代硬分段函数，消除梯度死区
  - 引入角速度惩罚，杀死"旋转刷分"问题
  - 平滑的乘法关系，鼓励协调控制两个摆杆
  - 处处可导的奖励函数，提供稳定的学习梯度

### 技术细节
- **问题1：梯度死区** 
  - 旧版：pole < 5° 时奖励恒定为 1.0，智能体没有动力精益求精
  - 新版：高斯函数处处有导数，每一点改进都有奖励反馈
  
- **问题2：旋转刷分**
  - 旧版：只看角度，第二阶高速旋转经过垂直点也能拿满分
  - 新版：角速度惩罚，只有"静止的直立"才能拿高分
  
- **问题3：不愿倾斜**
  - 旧版：P1 从 5° 变成 6° 奖励立刻从 1.0 掉到 0.97，损失太大
  - 新版：平滑过渡，P1 适度倾斜去救 P2 的收益更明显
  
- **问题4：梯度不连续**
  - 旧版：阶梯函数在切换点导数不连续，学习不稳定
  - 新版：高斯函数处处可导，PPO 能获得稳定的梯度信号

### 配置选项
```python
'reward_config': {
    'use_multiplicative': True,   # 启用乘法奖励
    'use_smooth_gaussian': True,  # 启用平滑高斯（推荐）
    'angle1_sigma': 0.10,         # 第一摆杆角度容忍度
    'angle2_sigma': 0.15,         # 第二摆杆角度容忍度
    'vel1_sigma': 5.0,            # 第一摆杆角速度容忍度
    'vel2_sigma': 10.0,           # 第二摆杆角速度容忍度
    'vel1_weight': 0.2,           # 第一摆杆速度权重
    'vel2_weight': 0.3,           # 第二摆杆速度权重
}
```

### 工具
- 📊 `compare_reward_functions.py` - 对比三种奖励函数的测试脚本
  - 加法奖励 vs 阶梯式乘法 vs 平滑高斯乘法
  - 梯度测试、旋转刷分测试、协调控制测试
  - 数值分析和可视化对比

## [1.0.0] - 2024-12-29

### 新增
- 🎯 倒立摆平衡任务（CartPole）
- 🌪️ 多种扰动测试功能
- 🤖 机械臂到达目标任务
- 🚶 火柴人行走任务
- ⚙️ 统一的配置系统
- 📊 W&B实验跟踪支持
- 🎨 美化的可视化界面
- 📈 TensorBoard日志记录
- 🔧 模块化奖励系统

### 特性
- 支持GPU/CPU自动检测
- 并行训练环境
- 实时性能监控
- 模型自动保存
- 向后兼容设计

### 技术栈
- Stable-Baselines3 (PPO算法)
- Gymnasium (环境接口)
- PyMunk (物理仿真)
- Pygame (可视化)
- PyTorch (深度学习)

## [未来计划]

### 即将发布
- [ ] 3D机械臂任务
- [ ] 障碍物避障
- [ ] 课程学习
- [ ] 更多算法支持

### 长期规划
- [ ] 视觉输入支持
- [ ] 多智能体协作
- [ ] 真实机器人接口
- [ ] Sim-to-real迁移